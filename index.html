<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Beron</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap');

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
}

body{
  background:#000;
  color:#fff;
  font-family:'Exo 2',sans-serif;
  overflow-x:hidden;
}

.app{
  width:100%;
  max-width:430px;
  min-height:100vh;
  margin:0 auto;
  background:linear-gradient(135deg,#0a0a0a 0%,#1a0520 100%);
  position:relative;
  overflow-y:auto;
  overflow-x:hidden;
  padding-bottom:80px;
}

.bg-pattern{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 20% 50%, rgba(0,102,255,0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(0,136,255,0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(0,170,255,0.05) 0%, transparent 50%);
  pointer-events:none;
  z-index:0;
}

.cyber-grid{
  position:fixed;
  inset:0;
  background-image:
    linear-gradient(rgba(0,102,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,102,255,0.03) 1px, transparent 1px);
  background-size:50px 50px;
  pointer-events:none;
  z-index:0;
  animation:gridScroll 20s linear infinite;
}

@keyframes gridScroll{
  0%{background-position:0 0}
  100%{background-position:50px 50px}
}

.content{
  position:relative;
  z-index:1;
  padding:20px;
}

.header{
  text-align:center;
  margin-bottom:30px;
  animation:slideDown 0.6s ease-out;
}

@keyframes slideDown{
  from{transform:translateY(-30px);opacity:0}
  to{transform:translateY(0);opacity:1}
}

.logo{
  font-family:'Orbitron',sans-serif;
  font-size:42px;
  font-weight:900;
  background:linear-gradient(45deg,#0066ff,#00aaff,#0066ff);
  background-size:200%;
  -webkit-background-clip:text;
  background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 40px rgba(0,102,255,0.5);
  animation:gradientShift 3s ease infinite;
  letter-spacing:3px;
}

@keyframes gradientShift{
  0%,100%{background-position:0%}
  50%{background-position:100%}
}

.stats-box{
  background:rgba(10,10,30,0.7);
  border-radius:20px;
  padding:20px;
  margin-bottom:25px;
  border:2px solid rgba(0,102,255,0.4);
  box-shadow:0 8px 32px rgba(0,102,255,0.2);
  backdrop-filter:blur(10px);
  animation:fadeIn 0.8s ease-out 0.2s both;
}

@keyframes fadeIn{
  from{opacity:0;transform:scale(0.9)}
  to{opacity:1;transform:scale(1)}
}

.coins{
  font-size:38px;
  font-weight:bold;
  color:#ffd700;
  text-shadow:0 0 20px rgba(255,215,0,0.6);
  margin-bottom:8px;
  font-family:'Orbitron',sans-serif;
}

.tokens,.rank{
  font-size:16px;
  color:#0088ff;
  margin:5px 0;
  text-shadow:0 0 10px rgba(0,136,255,0.5);
}

.energy-bar{
  width:100%;
  height:8px;
  background:rgba(0,0,0,0.5);
  border-radius:10px;
  margin-top:12px;
  overflow:hidden;
  border:1px solid rgba(0,102,255,0.3);
}

.energy-fill{
  height:100%;
  background:linear-gradient(90deg,#0066ff,#00aaff);
  border-radius:10px;
  transition:width 0.3s;
  box-shadow:0 0 10px rgba(0,136,255,0.6);
}

.tap-section{
  text-align:center;
  margin:30px 0;
  animation:fadeIn 1s ease-out 0.4s both;
}

.tap-btn{
  width:200px;
  height:200px;
  border-radius:50%;
  border:none;
  background:linear-gradient(135deg,#0066ff 0%,#0088ff 50%,#00aaff 100%);
  color:#fff;
  font-size:32px;
  font-weight:900;
  font-family:'Orbitron',sans-serif;
  cursor:pointer;
  box-shadow:
    0 0 40px rgba(0,102,255,0.6),
    0 0 80px rgba(0,102,255,0.3),
    inset 0 0 20px rgba(255,255,255,0.2);
  transition:all 0.15s;
  position:relative;
  overflow:hidden;
  touch-action:none;
}

.tap-btn::before{
  content:'';
  position:absolute;
  inset:-10px;
  background:linear-gradient(45deg,transparent,rgba(255,255,255,0.3),transparent);
  animation:shine 2s linear infinite;
}

@keyframes shine{
  0%{transform:translateX(-100%) rotate(45deg)}
  100%{transform:translateX(200%) rotate(45deg)}
}

.tap-btn:active{
  transform:scale(0.92);
  box-shadow:
    0 0 20px rgba(0,102,255,0.8),
    inset 0 0 30px rgba(0,0,0,0.3);
}

.tap-btn.cooldown{
  opacity:0.6;
  cursor:not-allowed;
  animation:pulse 0.5s;
}

@keyframes pulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.05)}
}

.click-effect{
  position:fixed;
  pointer-events:none;
  font-size:24px;
  font-weight:bold;
  color:#ffd700;
  text-shadow:0 0 10px rgba(255,215,0,0.8);
  animation:floatUp 1s ease-out forwards;
  z-index:9999;
  font-family:'Orbitron',sans-serif;
}

@keyframes floatUp{
  0%{opacity:1;transform:translateY(0) scale(1)}
  100%{opacity:0;transform:translateY(-100px) scale(1.5)}
}

.quick-actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin:25px 0;
  animation:fadeIn 1.2s ease-out 0.6s both;
}

.action-btn{
  background:linear-gradient(135deg,rgba(0,102,255,0.2),rgba(0,136,255,0.2));
  border:2px solid rgba(0,102,255,0.4);
  color:#0088ff;
  padding:14px;
  border-radius:15px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s;
  backdrop-filter:blur(10px);
  text-shadow:0 0 5px rgba(0,136,255,0.5);
}

.action-btn:hover{
  background:linear-gradient(135deg,rgba(0,102,255,0.3),rgba(0,136,255,0.3));
  transform:translateY(-2px);
  box-shadow:0 5px 20px rgba(0,102,255,0.3);
}

.action-btn:active{
  transform:translateY(0);
}

.games-section{
  margin-top:30px;
  animation:fadeIn 1.4s ease-out 0.8s both;
}

.section-title{
  font-family:'Orbitron',sans-serif;
  font-size:24px;
  color:#0088ff;
  margin-bottom:15px;
  text-shadow:0 0 10px rgba(0,136,255,0.6);
  text-align:center;
}

.games-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.game-card{
  background:linear-gradient(135deg,rgba(20,40,80,0.8),rgba(20,60,100,0.8));
  border:2px solid rgba(0,136,255,0.3);
  border-radius:15px;
  padding:20px;
  text-align:center;
  cursor:pointer;
  transition:all 0.3s;
  backdrop-filter:blur(10px);
}

.game-card:hover{
  transform:translateY(-5px) scale(1.02);
  border-color:rgba(0,136,255,0.6);
  box-shadow:0 10px 30px rgba(0,136,255,0.3);
}

.game-icon{
  font-size:40px;
  margin-bottom:10px;
  filter:drop-shadow(0 0 10px rgba(0,136,255,0.6));
}

.game-name{
  font-size:16px;
  font-weight:600;
  color:#0088ff;
  text-shadow:0 0 5px rgba(0,136,255,0.5);
}

.game-reward{
  font-size:12px;
  color:#00aaff;
  margin-top:5px;
}

.nav-menu{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:rgba(10,10,30,0.95);
  backdrop-filter:blur(20px);
  border-top:2px solid rgba(0,102,255,0.3);
  padding:10px;
  z-index:100;
  display:flex;
  gap:8px;
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
}

.nav-item{
  background:rgba(0,102,255,0.1);
  border:1px solid rgba(0,102,255,0.3);
  color:#0088ff;
  padding:8px 12px;
  border-radius:10px;
  font-size:11px;
  white-space:nowrap;
  cursor:pointer;
  transition:all 0.3s;
  flex-shrink:0;
}

.nav-item:active{
  background:rgba(0,102,255,0.2);
  transform:scale(0.95);
}

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:999;
  backdrop-filter:blur(10px);
  overflow-y:auto;
}

.popup.active{display:flex}

.popup-content{
  background:linear-gradient(135deg,rgba(20,40,80,0.9),rgba(20,60,100,0.9));
  border:3px solid rgba(0,102,255,0.5);
  border-radius:25px;
  padding:30px;
  text-align:center;
  max-width:90%;
  animation:popIn 0.4s cubic-bezier(0.68,-0.55,0.265,1.55);
}

@keyframes popIn{
  0%{transform:scale(0);opacity:0}
  100%{transform:scale(1);opacity:1}
}

.popup-title{
  font-size:28px;
  color:#0088ff;
  margin-bottom:20px;
  font-family:'Orbitron',sans-serif;
  text-shadow:0 0 20px rgba(0,136,255,0.6);
}

.popup-reward{
  font-size:48px;
  color:#ffd700;
  margin:20px 0;
  font-weight:bold;
  text-shadow:0 0 30px rgba(255,215,0,0.8);
  font-family:'Orbitron',sans-serif;
}

.popup-btn{
  background:linear-gradient(135deg,#0066ff,#0088ff);
  color:#fff;
  border:none;
  padding:12px 30px;
  border-radius:15px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  margin:8px;
  box-shadow:0 5px 20px rgba(0,102,255,0.4);
  transition:all 0.3s;
}

.popup-btn:active{
  transform:scale(0.95);
}

.game-canvas{
  width:100%;
  max-width:350px;
  height:500px;
  background:rgba(0,0,0,0.8);
  border:3px solid rgba(0,102,255,0.5);
  border-radius:15px;
  margin:20px auto;
  position:relative;
}

.game-score{
  position:absolute;
  top:10px;
  right:10px;
  font-size:24px;
  color:#ffd700;
  font-weight:bold;
  text-shadow:0 0 10px rgba(255,215,0,0.8);
  font-family:'Orbitron',sans-serif;
  z-index:10;
}

.game-over{
  position:absolute;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  background:rgba(0,0,0,0.9);
  border-radius:15px;
  z-index:20;
}

.game-over.active{display:flex}

.game-over-text{
  font-size:36px;
  color:#ff0066;
  margin-bottom:20px;
  font-family:'Orbitron',sans-serif;
  text-shadow:0 0 20px rgba(255,0,102,0.8);
}
</style>
</head>
<body>
<div class="app">
<div class="bg-pattern"></div>
<div class="cyber-grid"></div>

<div class="content">
<div class="header">
  <div class="logo">Beron</div>
</div>

<div class="stats-box">
  <div class="coins" id="coins">0</div>
  <div class="tokens" id="tokens">BER: 0</div>
  <div class="rank" id="rank">Rank: Bronze</div>
  <div class="energy-bar">
    <div class="energy-fill" id="energyBar" style="width:100%"></div>
  </div>
  <div style="font-size:12px;color:#0088ff;margin-top:5px;text-align:center">Energy: <span id="energyText">100/100</span></div>
</div>

<div class="tap-section">
  <button class="tap-btn" id="tapBtn">TAP</button>
</div>

<div class="quick-actions">
  <button class="action-btn" onclick="openCase()">üé∞ Daily Case</button>
  <button class="action-btn" onclick="exchange()">üíé Exchange</button>
</div>

<div class="games-section">
  <div class="section-title">üéÆ Mini Games</div>
  <div class="games-grid">
    <div class="game-card" onclick="startDropGame()">
      <div class="game-icon">‚≠ê</div>
      <div class="game-name">Drop Game</div>
      <div class="game-reward">Tap & Earn</div>
    </div>
    <div class="game-card" onclick="startSnakeGame()">
      <div class="game-icon">üêç</div>
      <div class="game-name">Snake</div>
      <div class="game-reward">Eat & grow!</div>
    </div>
    <div class="game-card" onclick="startFlappyGame()">
      <div class="game-icon">ü¶Ö</div>
      <div class="game-name">Cyber Bird</div>
      <div class="game-reward">Fly high!</div>
    </div>
    <div class="game-card" onclick="startMemoryGame()">
      <div class="game-icon">üß†</div>
      <div class="game-name">Memory</div>
      <div class="game-reward">Match cards!</div>
    </div>
  </div>
</div>

<div style="height:100px"></div>
</div>

<div class="nav-menu">
  <div class="nav-item">‚ö°Ô∏è Mine</div>
  <div class="nav-item">üé∞ Cases</div>
  <div class="nav-item">üìà Market</div>
  <div class="nav-item">üåü Skills</div>
  <div class="nav-item">üéü Pass</div>
  <div class="nav-item">üë• Clans</div>
  <div class="nav-item">‚öîÔ∏è PvP</div>
  <div class="nav-item">üî• Rebirth</div>
  <div class="nav-item">üèÜ Leaderboard</div>
  <div class="nav-item">üíé Withdraw</div>
</div>
</div>

<!-- Case Popup -->
<div class="popup" id="casePopup">
  <div class="popup-content">
    <div class="popup-title">üé∞ Daily Case</div>
    <div class="popup-reward" id="caseReward">0</div>
    <button class="popup-btn" onclick="closeCase()">Claim!</button>
  </div>
</div>

<!-- Drop Game -->
<div class="popup" id="dropGamePopup">
  <div class="popup-content" style="max-width:400px">
    <div class="popup-title">‚≠ê Star Tap Game</div>
    <div class="game-canvas" id="dropCanvas">
      <div style="position:absolute;top:10px;left:10px;font-size:24px;color:#ffd700;font-weight:bold;text-shadow:0 0 10px rgba(255,215,0,0.8);font-family:'Orbitron',sans-serif;z-index:10;" id="dropTimer">00:30</div>
      <div class="game-score" id="dropScore">BP: 0</div>
      <canvas id="dropGameCanvas" width="350" height="500"></canvas>
      <div class="game-over" id="dropGameOver">
        <div class="game-over-text">TIME'S UP!</div>
        <div style="font-size:24px;color:#ffd700;margin-bottom:20px">BP Earned: <span id="dropEarned">0</span> üí∞</div>
        <button class="popup-btn" onclick="restartDropGame()">Play Again</button>
        <button class="popup-btn" onclick="closeDropGame()">Exit</button>
      </div>
    </div>
  </div>
</div>

<!-- Snake Game -->
<div class="popup" id="snakeGamePopup">
  <div class="popup-content" style="max-width:400px">
    <div class="popup-title">üêç Snake Game</div>
    <div class="game-canvas" id="snakeCanvas">
      <div class="game-score" id="snakeScore">0</div>
      <canvas id="snakeGameCanvas" width="350" height="500"></canvas>
      <div class="game-over" id="snakeGameOver">
        <div class="game-over-text">GAME OVER</div>
        <div style="font-size:24px;color:#ffd700;margin-bottom:20px">Earned: <span id="snakeEarned">0</span> üí∞</div>
        <button class="popup-btn" onclick="restartSnakeGame()">Play Again</button>
        <button class="popup-btn" onclick="closeSnakeGame()">Exit</button>
      </div>
    </div>
  </div>
</div>

<!-- Flappy Game -->
<div class="popup" id="flappyGamePopup">
  <div class="popup-content" style="max-width:400px">
    <div class="popup-title">ü¶Ö Cyber Bird</div>
    <div class="game-canvas" id="flappyCanvas">
      <div class="game-score" id="flappyScore">0</div>
      <canvas id="flappyGameCanvas" width="350" height="500"></canvas>
      <div class="game-over" id="flappyGameOver">
        <div class="game-over-text">GAME OVER</div>
        <div style="font-size:24px;color:#ffd700;margin-bottom:20px">Earned: <span id="flappyEarned">0</span> üí∞</div>
        <button class="popup-btn" onclick="restartFlappyGame()">Play Again</button>
        <button class="popup-btn" onclick="closeFlappyGame()">Exit</button>
      </div>
    </div>
  </div>
</div>

<!-- Memory Game -->
<div class="popup" id="memoryGamePopup">
  <div class="popup-content" style="max-width:400px">
    <div class="popup-title">üß† Memory Game</div>
    <div style="font-size:18px;color:#0088ff;margin-bottom:15px">Find all pairs!</div>
    <div class="game-score" style="position:static;margin-bottom:15px">Score: <span id="memoryScore">0</span></div>
    <div id="memoryGrid" style="display:grid;grid-template-columns:repeat(4,70px);gap:10px;justify-content:center;margin:20px auto"></div>
    <button class="popup-btn" onclick="closeMemoryGame()" style="margin-top:20px">Exit</button>
  </div>
</div>

<script>
// Disable only specific touch behaviors
document.addEventListener('contextmenu', e => e.preventDefault());

// Game state
let coins = parseInt(localStorage.getItem('coins')) || 0;
let tokens = parseInt(localStorage.getItem('tokens')) || 0;
let lastCase = parseInt(localStorage.getItem('lastCase')) || 0;
let energy = parseInt(localStorage.getItem('energy')) || 100;
let lastEnergyUpdate = parseInt(localStorage.getItem('lastEnergyUpdate')) || Date.now();

function save() {
  localStorage.setItem('coins', coins);
  localStorage.setItem('tokens', tokens);
  localStorage.setItem('lastCase', lastCase);
  localStorage.setItem('energy', energy);
  localStorage.setItem('lastEnergyUpdate', lastEnergyUpdate);
}

function updateUI() {
  document.getElementById('coins').innerText = coins.toLocaleString();
  document.getElementById('tokens').innerText = 'BER: ' + tokens;
  
  let rank = 'Bronze';
  if (coins > 1000000) rank = 'Diamond';
  else if (coins > 500000) rank = 'Platinum';
  else if (coins > 100000) rank = 'Gold';
  else if (coins > 10000) rank = 'Silver';
  document.getElementById('rank').innerText = 'Rank: ' + rank;
  
  const energyPercent = Math.min(100, (energy / 100) * 100);
  document.getElementById('energyBar').style.width = energyPercent + '%';
  document.getElementById('energyText').innerText = energy + '/100';
}

// Energy regeneration
setInterval(() => {
  const now = Date.now();
  const elapsed = now - lastEnergyUpdate;
  const regenAmount = Math.floor(elapsed / 1000);
  
  if (regenAmount > 0 && energy < 100) {
    energy = Math.min(100, energy + regenAmount);
    lastEnergyUpdate = now;
    save();
    updateUI();
  }
}, 1000);

updateUI();

// TAP SYSTEM
const tapBtn = document.getElementById('tapBtn');
let lastTap = 0;
let tapCombo = 0;
let comboTimer;

tapBtn.addEventListener('touchstart', handleTap);
tapBtn.addEventListener('click', handleTap);

function handleTap(e) {
  e.preventDefault();
  
  const now = Date.now();
  if (now - lastTap < 50) {
    tapBtn.classList.add('cooldown');
    setTimeout(() => tapBtn.classList.remove('cooldown'), 200);
    return;
  }
  
  if (energy <= 0) {
    showFloatingText('No energy!', e.touches?.[0]?.clientX || e.clientX, e.touches?.[0]?.clientY || e.clientY);
    return;
  }
  
  lastTap = now;
  energy = Math.max(0, energy - 1);
  
  // Calculate reward
  let crit = Math.random();
  let gain = 1;
  let critText = '';
  
  if (crit > 0.98) {
    gain = 100;
    critText = ' üí•MEGA!';
  } else if (crit > 0.95) {
    gain = 50;
    critText = ' ‚ö°SUPER!';
  } else if (crit > 0.85) {
    gain = 10;
    critText = ' ‚ú®CRIT!';
  }
  
  // Combo system
  clearTimeout(comboTimer);
  tapCombo++;
  comboTimer = setTimeout(() => tapCombo = 0, 2000);
  
  if (tapCombo > 10) gain *= 2;
  if (tapCombo > 20) gain *= 3;
  
  coins += gain;
  save();
  updateUI();
  
  // Visual feedback
  const x = e.touches?.[0]?.clientX || e.clientX;
  const y = e.touches?.[0]?.clientY || e.clientY;
  showFloatingText('+' + gain + critText, x, y);
}

function showFloatingText(text, x, y) {
  const el = document.createElement('div');
  el.className = 'click-effect';
  el.innerText = text;
  el.style.left = x + 'px';
  el.style.top = y + 'px';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1000);
}

// DAILY CASE
function openCase() {
  const now = Date.now();
  if (now - lastCase < 86400000) {
    const timeLeft = 86400000 - (now - lastCase);
    const hours = Math.floor(timeLeft / 3600000);
    const mins = Math.floor((timeLeft % 3600000) / 60000);
    alert(`Case available in ${hours}h ${mins}m`);
    return;
  }
  
  lastCase = now;
  localStorage.setItem('lastCase', lastCase);
  
  const popup = document.getElementById('casePopup');
  const rewardEl = document.getElementById('caseReward');
  popup.classList.add('active');
  
  const rewards = [10000, 5000, 3000, 1000, 500, 300, 100];
  let spins = 25;
  let i = 0;
  
  const spinInterval = setInterval(() => {
    rewardEl.innerText = rewards[Math.floor(Math.random() * rewards.length)];
    i++;
    if (i > spins) {
      clearInterval(spinInterval);
      const win = rewards[Math.floor(Math.random() * rewards.length)];
      rewardEl.innerText = win + ' üí∞';
      coins += win;
      save();
      updateUI();
    }
  }, 100);
}

function closeCase() {
  document.getElementById('casePopup').classList.remove('active');
}

// EXCHANGE
function exchange() {
  if (coins >= 1000) {
    coins -= 1000;
    tokens += 10;
    save();
    updateUI();
    alert('‚úÖ Exchanged! +10 BER');
  } else {
    alert('‚ùå Not enough coins (need 1000)');
  }
}

// === STAR TAP GAME ===
let dropGame = null;

function startDropGame() {
  document.getElementById('dropGamePopup').classList.add('active');
  document.getElementById('dropGameOver').classList.remove('active');
  
  const canvas = document.getElementById('dropGameCanvas');
  const ctx = canvas.getContext('2d');
  
  dropGame = {
    bp: 0,
    drops: [],
    gameOver: false,
    frame: 0,
    timeLeft: 30,
    startTime: Date.now()
  };
  
  document.getElementById('dropScore').innerText = 'BP: 0';
  document.getElementById('dropTimer').innerText = '00:30';
  
  function gameLoop() {
    if (dropGame.gameOver) return;
    
    // Update timer
    const elapsed = Math.floor((Date.now() - dropGame.startTime) / 1000);
    dropGame.timeLeft = Math.max(0, 30 - elapsed);
    
    // Format timer display
    const mins = Math.floor(dropGame.timeLeft / 60);
    const secs = dropGame.timeLeft % 60;
    document.getElementById('dropTimer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    
    if (dropGame.timeLeft <= 0) {
      endDropGame();
      return;
    }
    
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Spawn drops
    dropGame.frame++;
    if (dropGame.frame % 20 === 0) {
      dropGame.drops.push({
        x: Math.random() * (canvas.width - 50),
        y: -50,
        type: Math.random() > 0.3 ? 'star' : 'bomb',
        speed: 2 + Math.random() * 2.5,
        size: 40,
        clicked: false
      });
    }
    
    // Update and draw drops
    dropGame.drops = dropGame.drops.filter(drop => {
      if (drop.clicked) return false;
      
      drop.y += drop.speed;
      
      // Draw drop - green stars like in image
      if (drop.type === 'star') {
        // Green glowing star
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#00ff00';
        ctx.fillStyle = '#00ff00';
        ctx.font = 'bold 35px Arial';
        ctx.fillText('‚ú±', drop.x + 5, drop.y + 32);
        ctx.shadowBlur = 0;
      } else {
        // Bomb
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ff0000';
        ctx.fillStyle = '#ff0000';
        ctx.font = 'bold 30px Arial';
        ctx.fillText('üí£', drop.x + 5, drop.y + 30);
        ctx.shadowBlur = 0;
      }
      
      return drop.y < canvas.height;
    });
    
    // Update score display
    document.getElementById('dropScore').innerText = 'BP: ' + dropGame.bp;
    
    requestAnimationFrame(gameLoop);
  }
  
  gameLoop();
  
  // Click/Touch handling
  function handleClick(e) {
    if (dropGame.gameOver) return;
    
    const rect = canvas.getBoundingClientRect();
    const clickX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    const clickY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
    
    // Check if clicked on any drop
    for (let i = dropGame.drops.length - 1; i >= 0; i--) {
      const drop = dropGame.drops[i];
      if (drop.clicked) continue;
      
      // Center of the visual element (adjusted for text rendering)
      const centerX = drop.x + 20;
      const centerY = drop.y + 20;
      
      const dx = clickX - centerX;
      const dy = clickY - centerY;
      const distance = Math.sqrt(dx * dx + dy * dy);
      
      // Larger hitbox for easier tapping (radius 30 instead of size/2)
      if (distance < 30) {
        drop.clicked = true;
        
        if (drop.type === 'star') {
          // Clicked on star - gain 10 BP
          dropGame.bp += 10;
        } else {
          // Clicked on bomb - lose 30 BP
          dropGame.bp = Math.max(0, dropGame.bp - 30);
        }
        
        break;
      }
    }
  }
  
  canvas.addEventListener('click', handleClick);
  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    handleClick(e);
  }, {passive: false});
}

function endDropGame() {
  dropGame.gameOver = true;
  const earned = dropGame.bp;
  coins += earned;
  save();
  updateUI();
  document.getElementById('dropEarned').innerText = earned;
  document.getElementById('dropGameOver').classList.add('active');
}

function restartDropGame() {
  startDropGame();
}

function closeDropGame() {
  dropGame = null;
  document.getElementById('dropGamePopup').classList.remove('active');
}

// === SNAKE GAME ===
let snakeGame = null;

function startSnakeGame() {
  document.getElementById('snakeGamePopup').classList.add('active');
  document.getElementById('snakeGameOver').classList.remove('active');
  
  const canvas = document.getElementById('snakeGameCanvas');
  const ctx = canvas.getContext('2d');
  const gridSize = 20;
  
  snakeGame = {
    snake: [{x: 10, y: 10}],
    direction: {x: 1, y: 0},
    nextDirection: {x: 1, y: 0},
    food: {x: 15, y: 15},
    score: 0,
    gameOver: false,
    speed: 100,
    lastUpdate: Date.now()
  };
  
  document.getElementById('snakeScore').innerText = '0';
  
  function placeFood() {
    snakeGame.food = {
      x: Math.floor(Math.random() * (canvas.width / gridSize)),
      y: Math.floor(Math.random() * (canvas.height / gridSize))
    };
  }
  
  function gameLoop() {
    if (snakeGame.gameOver) return;
    
    const now = Date.now();
    // REMOVED DELAY - instant response
    
    snakeGame.lastUpdate = now;
    
    // Update direction - INSTANT
    snakeGame.direction = snakeGame.nextDirection;
    
    // Move snake
    const head = {
      x: snakeGame.snake[0].x + snakeGame.direction.x,
      y: snakeGame.snake[0].y + snakeGame.direction.y
    };
    
    // Check collisions
    if (head.x < 0 || head.x >= canvas.width / gridSize ||
        head.y < 0 || head.y >= canvas.height / gridSize ||
        snakeGame.snake.some(seg => seg.x === head.x && seg.y === head.y)) {
      endSnakeGame();
      return;
    }
    
    snakeGame.snake.unshift(head);
    
    // Check food
    if (head.x === snakeGame.food.x && head.y === snakeGame.food.y) {
      snakeGame.score += 10;
      document.getElementById('snakeScore').innerText = snakeGame.score;
      placeFood();
    } else {
      snakeGame.snake.pop();
    }
    
    // Draw
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Grid
    ctx.strokeStyle = '#111';
    for (let i = 0; i < canvas.width; i += gridSize) {
      ctx.beginPath();
      ctx.moveTo(i, 0);
      ctx.lineTo(i, canvas.height);
      ctx.stroke();
    }
    for (let i = 0; i < canvas.height; i += gridSize) {
      ctx.beginPath();
      ctx.moveTo(0, i);
      ctx.lineTo(canvas.width, i);
      ctx.stroke();
    }
    
    // Snake
    ctx.fillStyle = '#00ff88';
    snakeGame.snake.forEach((seg, i) => {
      ctx.fillRect(seg.x * gridSize + 1, seg.y * gridSize + 1, gridSize - 2, gridSize - 2);
      if (i === 0) {
        ctx.fillStyle = '#00ffff';
        ctx.fillRect(seg.x * gridSize + 1, seg.y * gridSize + 1, gridSize - 2, gridSize - 2);
        ctx.fillStyle = '#00ff88';
      }
    });
    
    // Food
    ctx.fillStyle = '#ffd700';
    ctx.fillRect(snakeGame.food.x * gridSize + 1, snakeGame.food.y * gridSize + 1, gridSize - 2, gridSize - 2);
    
    // Add delay here for snake movement speed
    setTimeout(() => requestAnimationFrame(gameLoop), snakeGame.speed);
  }
  
  gameLoop();
  
  // Touch controls - INSTANT RESPONSE
  let touchStartX = 0;
  let touchStartY = 0;
  
  canvas.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });
  
  canvas.addEventListener('touchend', (e) => {
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    const dx = touchEndX - touchStartX;
    const dy = touchEndY - touchStartY;
    
    // INSTANT direction change
    if (Math.abs(dx) > Math.abs(dy)) {
      if (dx > 0 && snakeGame.direction.x === 0) snakeGame.nextDirection = {x: 1, y: 0};
      if (dx < 0 && snakeGame.direction.x === 0) snakeGame.nextDirection = {x: -1, y: 0};
    } else {
      if (dy > 0 && snakeGame.direction.y === 0) snakeGame.nextDirection = {x: 0, y: 1};
      if (dy < 0 && snakeGame.direction.y === 0) snakeGame.nextDirection = {x: 0, y: -1};
    }
  });
  
  // Keyboard controls - INSTANT RESPONSE
  document.addEventListener('keydown', (e) => {
    if (!snakeGame || snakeGame.gameOver) return;
    if (e.key === 'ArrowUp' && snakeGame.direction.y === 0) snakeGame.nextDirection = {x: 0, y: -1};
    if (e.key === 'ArrowDown' && snakeGame.direction.y === 0) snakeGame.nextDirection = {x: 0, y: 1};
    if (e.key === 'ArrowLeft' && snakeGame.direction.x === 0) snakeGame.nextDirection = {x: -1, y: 0};
    if (e.key === 'ArrowRight' && snakeGame.direction.x === 0) snakeGame.nextDirection = {x: 1, y: 0};
  });
}

function endSnakeGame() {
  snakeGame.gameOver = true;
  const earned = snakeGame.score * 3;
  coins += earned;
  save();
  updateUI();
  document.getElementById('snakeEarned').innerText = earned;
  document.getElementById('snakeGameOver').classList.add('active');
}

function restartSnakeGame() {
  startSnakeGame();
}

function closeSnakeGame() {
  snakeGame = null;
  document.getElementById('snakeGamePopup').classList.remove('active');
}

// === FLAPPY GAME ===
let flappyGame = null;

function startFlappyGame() {
  document.getElementById('flappyGamePopup').classList.add('active');
  document.getElementById('flappyGameOver').classList.remove('active');
  
  const canvas = document.getElementById('flappyGameCanvas');
  const ctx = canvas.getContext('2d');
  
  flappyGame = {
    birdY: 250,
    birdVelocity: 0,
    gravity: 0.6,
    jumpPower: -9,
    pipes: [],
    score: 0,
    gameOver: false,
    frame: 0
  };
  
  document.getElementById('flappyScore').innerText = '0';
  
  function gameLoop() {
    if (flappyGame.gameOver) return;
    
    ctx.fillStyle = '#001122';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Update bird
    flappyGame.birdVelocity += flappyGame.gravity;
    flappyGame.birdY += flappyGame.birdVelocity;
    
    // Check bounds
    if (flappyGame.birdY < 0 || flappyGame.birdY > canvas.height - 30) {
      endFlappyGame();
      return;
    }
    
    // Spawn pipes
    flappyGame.frame++;
    if (flappyGame.frame % 80 === 0) {
      const gap = 150;
      const pipeHeight = 100 + Math.random() * 200;
      flappyGame.pipes.push({
        x: canvas.width,
        topHeight: pipeHeight,
        bottomY: pipeHeight + gap,
        scored: false
      });
    }
    
    // Update and draw pipes
    flappyGame.pipes = flappyGame.pipes.filter(pipe => {
      pipe.x -= 4;
      
      // Draw pipes
      ctx.fillStyle = '#00ff88';
      ctx.fillRect(pipe.x, 0, 50, pipe.topHeight);
      ctx.fillRect(pipe.x, pipe.bottomY, 50, canvas.height - pipe.bottomY);
      
      // Collision
      if (pipe.x < 80 && pipe.x > 0) {
        if (flappyGame.birdY < pipe.topHeight || flappyGame.birdY + 30 > pipe.bottomY) {
          endFlappyGame();
          return false;
        }
      }
      
      // Score
      if (!pipe.scored && pipe.x + 50 < 50) {
        pipe.scored = true;
        flappyGame.score++;
        document.getElementById('flappyScore').innerText = flappyGame.score;
      }
      
      return pipe.x > -50;
    });
    
    // Draw bird
    ctx.fillStyle = '#00ffff';
    ctx.fillRect(50, flappyGame.birdY, 30, 30);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('ü¶Ö', 52, flappyGame.birdY + 24);
    
    requestAnimationFrame(gameLoop);
  }
  
  gameLoop();
  
  // Controls
  const jump = () => {
    if (!flappyGame.gameOver) {
      flappyGame.birdVelocity = flappyGame.jumpPower;
    }
  };
  
  canvas.addEventListener('touchstart', jump);
  canvas.addEventListener('click', jump);
}

function endFlappyGame() {
  flappyGame.gameOver = true;
  const earned = flappyGame.score * 20;
  coins += earned;
  save();
  updateUI();
  document.getElementById('flappyEarned').innerText = earned;
  document.getElementById('flappyGameOver').classList.add('active');
}

function restartFlappyGame() {
  startFlappyGame();
}

function closeFlappyGame() {
  flappyGame = null;
  document.getElementById('flappyGamePopup').classList.remove('active');
}

// === MEMORY GAME ===
const memoryEmojis = ['üíé', 'üî•', '‚ö°', 'üåü', 'üí∞', 'üéÆ', 'üöÄ', 'üëë'];
let memoryGame = null;

function startMemoryGame() {
  document.getElementById('memoryGamePopup').classList.add('active');
  
  const cards = [...memoryEmojis, ...memoryEmojis].sort(() => Math.random() - 0.5);
  
  memoryGame = {
    cards: cards,
    flipped: [],
    matched: [],
    score: 0,
    moves: 0
  };
  
  const grid = document.getElementById('memoryGrid');
  grid.innerHTML = '';
  
  cards.forEach((emoji, index) => {
    const card = document.createElement('div');
    card.style.cssText = `
      width:70px;height:70px;background:linear-gradient(135deg,#0066ff,#0088ff);
      border-radius:10px;display:flex;align-items:center;justify-content:center;
      font-size:32px;cursor:pointer;transition:all 0.3s;
      border:2px solid rgba(0,136,255,0.5);
    `;
    card.dataset.index = index;
    card.dataset.emoji = emoji;
    card.innerText = '?';
    
    card.onclick = () => flipCard(card, index);
    
    grid.appendChild(card);
  });
  
  document.getElementById('memoryScore').innerText = '0';
}

function flipCard(card, index) {
  if (memoryGame.flipped.length >= 2 || 
      memoryGame.flipped.includes(index) || 
      memoryGame.matched.includes(index)) return;
  
  card.innerText = card.dataset.emoji;
  card.style.background = 'linear-gradient(135deg,#00aaff,#0066ff)';
  memoryGame.flipped.push(index);
  
  if (memoryGame.flipped.length === 2) {
    memoryGame.moves++;
    const [idx1, idx2] = memoryGame.flipped;
    const card1 = document.querySelector(`[data-index="${idx1}"]`);
    const card2 = document.querySelector(`[data-index="${idx2}"]`);
    
    if (card1.dataset.emoji === card2.dataset.emoji) {
      memoryGame.matched.push(idx1, idx2);
      memoryGame.score += 100;
      document.getElementById('memoryScore').innerText = memoryGame.score;
      memoryGame.flipped = [];
      
      if (memoryGame.matched.length === memoryGame.cards.length) {
        setTimeout(() => {
          coins += memoryGame.score * 2;
          save();
          updateUI();
          alert(`üéâ Victory! +${memoryGame.score * 2} coins!`);
          startMemoryGame();
        }, 500);
      }
    } else {
      setTimeout(() => {
        card1.innerText = '?';
        card2.innerText = '?';
        card1.style.background = 'linear-gradient(135deg,#0066ff,#0088ff)';
        card2.style.background = 'linear-gradient(135deg,#0066ff,#0088ff)';
        memoryGame.flipped = [];
      }, 600);
    }
  }
}

function closeMemoryGame() {
  if (memoryGame && memoryGame.matched.length > 0) {
    coins += memoryGame.score;
    save();
    updateUI();
  }
  memoryGame = null;
  document.getElementById('memoryGamePopup').classList.remove('active');
}
</script>
</body>
</html>
